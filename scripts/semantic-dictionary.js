// ULTIMATE SEMANTIC DICTIONARY FOR FONTCOOK
// 5000+ keywords across all domains with intelligent phrase processing

// === COMPREHENSIVE KEYWORD COLLECTIONS ===
const KEYWORD_COLLECTIONS = {
  
  // === BUSINESS SECTORS ===
  food: [
    "restaurant", "eatery", "dining", "bistro", "brasserie", "cafe", "diner", "tavern", "pub", 
    "fast-food", "fastfood", "burger", "pizza", "sandwich", "taco", "hotdog", "fries", "takeaway",
    "fine-dining", "upscale", "gourmet", "haute-cuisine", "michelin", "luxury-restaurant", "steakhouse",
    "bakery", "patisserie", "cake-shop", "bread", "pastry", "dessert", "cupcake", "donut", "croissant",
    "coffee", "coffeehouse", "espresso", "roastery", "barista", "latte", "cappuccino", "brewing",
    "bar", "cocktail", "wine", "brewery", "distillery", "whiskey", "vodka", "rum", "gin",
    "ice-cream", "gelato", "frozen-yogurt", "smoothie", "juice", "tea", "organic", "vegan",
    "chef", "cook", "kitchen", "culinary", "menu", "recipe", "cooking", "baking", "grilling",
    "seafood", "sushi", "ramen", "noodles", "pasta", "italian", "mexican", "chinese", "indian"
  ],
  
  automotive: [
    "garage", "mechanic", "auto-repair", "car-service", "workshop", "bodyshop", "tire-shop",
    "luxury-cars", "premium-automotive", "exotic-cars", "supercar", "ferrari", "lamborghini",
    "car-dealer", "dealership", "car-sales", "used-cars", "showroom", "automotive",
    "motorcycle", "bike", "harley", "yamaha", "honda", "racing", "formula", "nascar",
    "truck", "pickup", "van", "suv", "sedan", "coupe", "convertible", "hybrid", "electric",
    "motor", "engine", "driving", "speed", "performance", "horsepower", "turbo", "diesel",
    "repair", "maintenance", "oil-change", "brake", "transmission", "exhaust", "tires", "wheels"
  ],
  
  construction: [
    "construction", "contractor", "building", "renovation", "remodeling", "architecture",
    "plumber", "plumbing", "pipes", "water", "drainage", "heating", "cooling", "hvac",
    "electrician", "electrical", "wiring", "lighting", "solar", "power", "energy",
    "carpenter", "woodworking", "furniture", "cabinetry", "custom-wood", "flooring",
    "painter", "painting", "decorator", "roofing", "concrete", "masonry", "landscaping",
    "builder", "developer", "real-estate", "property", "home", "house", "commercial", "residential"
  ],
  
  healthcare: [
    "doctor", "physician", "medical", "clinic", "hospital", "surgery", "dentist", "dental",
    "veterinarian", "vet", "animal-clinic", "pet-care", "pharmacy", "medicine", "health",
    "spa", "wellness", "massage", "relaxation", "zen", "healing", "therapy", "physiotherapy",
    "salon", "hair", "beauty", "stylist", "barber", "nail", "makeup", "skincare", "cosmetics",
    "nurse", "surgeon", "pharmacist", "therapist", "healer", "chiropractor", "optometrist"
  ],
  
  professional: [
    "law", "legal", "attorney", "lawyer", "jurisprudence", "court", "judge", "paralegal",
    "accounting", "finance", "bookkeeping", "tax", "cpa", "audit", "banking", "investment",
    "real-estate", "property", "realty", "homes", "housing", "mortgage", "broker",
    "consulting", "business", "corporate", "management", "strategy", "hr", "recruitment",
    "insurance", "agent", "policy", "claims", "risk", "security", "protection",
    "notary", "mediator", "arbitrator", "legal-services", "law-firm", "chambers"
  ],
  
  technology: [
    "tech", "technology", "software", "digital", "startup", "app", "mobile", "web",
    "computer", "laptop", "pc", "mac", "gaming", "console", "playstation", "xbox",
    "programming", "coding", "developer", "engineer", "data", "cloud", "ai", "robotics",
    "cyber", "security", "network", "internet", "website", "ecommerce", "online", "saas",
    "blockchain", "cryptocurrency", "bitcoin", "ethereum", "nft", "defi", "web3", "metaverse",
    "innovation", "artificial-intelligence", "machine-learning", "analytics", "big-data"
  ],
  
  education: [
    "school", "education", "university", "college", "academy", "institute", "learning",
    "teacher", "professor", "tutor", "student", "kindergarten", "elementary", "high-school",
    "library", "books", "reading", "writing", "literature", "academic", "research",
    "training", "course", "workshop", "seminar", "conference", "certification",
    "campus", "classroom", "lecture", "study", "exam", "degree", "diploma", "graduation"
  ],
  
  retail: [
    "shop", "store", "boutique", "mall", "shopping", "retail", "market", "supermarket",
    "clothing", "fashion", "apparel", "shoes", "accessories", "jewelry", "watches",
    "electronics", "gadgets", "phones", "tablets", "headphones", "speakers", "camera",
    "furniture", "home", "decor", "interior", "kitchen", "bedroom", "living-room",
    "sports", "fitness", "gym", "athletic", "outdoor", "hiking", "camping", "fishing",
    "sale", "discount", "bargain", "clearance", "promotion", "deal", "offer"
  ],
  
  entertainment: [
    "cinema", "movie", "theater", "film", "entertainment", "music", "concert", "band",
    "festival", "event", "party", "celebration", "wedding", "birthday", "anniversary",
    "gaming", "casino", "poker", "slots", "betting", "lottery", "arcade", "amusement",
    "park", "zoo", "aquarium", "museum", "gallery", "art", "culture", "tourism", "travel",
    "nightclub", "disco", "karaoke", "comedy", "standup", "performance", "show", "stage"
  ],

  // === EXPANDED BUSINESS CATEGORIES ===
  beauty: [
    "beauty", "cosmetics", "makeup", "skincare", "perfume", "spa", "wellness", "care", "treatment", 
    "salon", "aesthetic", "glamour", "gorgeous", "stunning", "beautiful", "pretty", "attractive", 
    "alluring", "charming", "radiant", "glowing", "flawless", "rejuvenating", "anti-aging",
    "manicure", "pedicure", "facial", "botox", "dermatology", "esthetics", "day-spa", "luxury-spa"
  ],

  fitness: [
    "fitness", "gym", "workout", "exercise", "training", "athletic", "performance", "strength",
    "cardio", "yoga", "pilates", "crossfit", "bodybuilding", "powerlifting", "marathon", "running",
    "cycling", "swimming", "boxing", "martial-arts", "kickboxing", "zumba", "aerobics", "spinning",
    "personal-trainer", "coach", "nutrition", "protein", "supplements", "wellness", "health"
  ],

  luxury: [
    "luxury", "premium", "exclusive", "elite", "high-end", "upscale", "sophisticated", "refined",
    "bespoke", "custom", "handcrafted", "artisan", "designer", "couture", "avant-garde", "iconic",
    "prestige", "status", "vip", "first-class", "five-star", "michelin", "concierge", "butler",
    "yacht", "private-jet", "mansion", "penthouse", "diamond", "gold", "platinum", "rolex"
  ],

  creative: [
    "creative", "art", "design", "artist", "designer", "studio", "gallery", "exhibition",
    "painting", "drawing", "sculpture", "photography", "graphic-design", "web-design", "ui-ux",
    "advertising", "marketing", "branding", "logo", "illustration", "animation", "video",
    "film", "production", "director", "cinematography", "editing", "sound", "music"
  ],

  // === TARGET AUDIENCES ===
  demographics: [
    "kids", "children", "baby", "toddler", "teenager", "teen", "youth", "young", "adult",
    "senior", "elderly", "family", "parents", "mother", "father", "women", "men", "unisex",
    "luxury", "premium", "budget", "affordable", "mass-market", "niche", "exclusive",
    "millennial", "gen-z", "boomer", "generation-x", "professional", "executive", "entrepreneur"
  ],
  
  // === EMOTIONS & MOODS ===
  emotions: [
    "happy", "joy", "cheerful", "fun", "playful", "exciting", "energetic", "vibrant",
    "calm", "peaceful", "serene", "relaxing", "zen", "tranquil", "meditation", "harmony",
    "love", "romantic", "passion", "heart", "valentine", "intimate", "sensual", "sexy",
    "angry", "aggressive", "bold", "strong", "powerful", "fierce", "intense", "dramatic",
    "sad", "melancholy", "nostalgic", "vintage", "retro", "classic", "timeless", "heritage",
    "mysterious", "dark", "gothic", "noir", "shadow", "midnight", "black", "deep",
    "bright", "sunny", "colorful", "rainbow", "neon", "glow", "shine", "sparkle", "glitter",
    "confident", "trustworthy", "reliable", "secure", "safe", "stable", "optimistic", "positive"
  ],
  
  // === VISUAL STYLES ===
  styles: [
    "minimal", "clean", "simple", "pure", "basic", "essential", "stripped", "bare",
    "ornate", "decorative", "fancy", "elaborate", "detailed", "complex", "rich", "lavish",
    "rustic", "rough", "raw", "organic", "natural", "earthy", "wooden", "stone", "brick",
    "sleek", "smooth", "polished", "refined", "sophisticated", "elegant", "classy", "chic",
    "futuristic", "sci-fi", "cyber", "neon", "digital", "electronic", "robotic", "space",
    "vintage", "retro", "antique", "old", "aged", "worn", "distressed", "grunge", "punk",
    "industrial", "urban", "metropolitan", "street", "underground", "alternative", "edgy"
  ],
  
  // === COLORS ===
  colors: [
    "red", "crimson", "scarlet", "ruby", "cherry", "blood", "fire", "passion", "rose",
    "blue", "navy", "azure", "cyan", "turquoise", "ocean", "sky", "ice", "frost", "royal",
    "green", "forest", "emerald", "lime", "mint", "sage", "olive", "jungle", "nature",
    "yellow", "gold", "amber", "sunny", "lemon", "butter", "honey", "wheat", "corn",
    "purple", "violet", "lavender", "plum", "grape", "royal", "majestic", "mystical",
    "orange", "tangerine", "peach", "coral", "sunset", "autumn", "pumpkin", "tiger",
    "pink", "rose", "blush", "salmon", "magenta", "fuchsia", "bubblegum", "cotton-candy",
    "brown", "chocolate", "coffee", "mocha", "tan", "beige", "cream", "caramel", "bronze",
    "black", "charcoal", "obsidian", "midnight", "coal", "ink", "shadow", "ebony",
    "white", "ivory", "cream", "pearl", "snow", "milk", "vanilla", "silver", "platinum",
    "gray", "grey", "slate", "steel", "storm", "ash", "smoke", "concrete", "neutral"
  ],
  
  // === MATERIALS & TEXTURES ===
  materials: [
    "wood", "wooden", "timber", "oak", "pine", "cedar", "bamboo", "teak", "mahogany",
    "metal", "steel", "iron", "aluminum", "copper", "bronze", "silver", "gold", "platinum",
    "stone", "marble", "granite", "slate", "concrete", "brick", "ceramic", "tile",
    "glass", "crystal", "transparent", "clear", "frosted", "mirror", "reflective",
    "fabric", "cotton", "silk", "wool", "linen", "canvas", "denim", "leather", "suede",
    "plastic", "rubber", "vinyl", "synthetic", "polymer", "resin", "acrylic", "carbon"
  ],
  
  // === THEMES & CONCEPTS ===
  themes: [
    "nature", "environment", "eco", "green", "sustainable", "organic", "natural", "earth",
    "urban", "city", "metropolitan", "downtown", "street", "industrial", "factory", "warehouse",
    "beach", "ocean", "sea", "surf", "tropical", "island", "paradise", "vacation", "resort",
    "mountain", "alpine", "hiking", "adventure", "outdoor", "wilderness", "camping", "forest",
    "space", "cosmic", "galaxy", "star", "planet", "universe", "astronaut", "rocket", "alien",
    "military", "army", "war", "soldier", "combat", "tactical", "camouflage", "weapons",
    "music", "rock", "jazz", "classical", "electronic", "pop", "hip-hop", "country", "blues",
    "sports", "football", "basketball", "baseball", "soccer", "tennis", "golf", "racing", "fitness"
  ],
  
  // === SPECIAL OCCASIONS ===
  occasions: [
    "wedding", "marriage", "bride", "groom", "anniversary", "engagement", "valentine", "love",
    "birthday", "party", "celebration", "gift", "present", "surprise", "festive", "joy",
    "christmas", "holiday", "winter", "snow", "santa", "gift", "tree", "ornament", "decoration",
    "halloween", "spooky", "scary", "ghost", "pumpkin", "witch", "magic", "mystery", "dark",
    "easter", "spring", "bunny", "egg", "flower", "bloom", "fresh", "new", "rebirth", "renewal",
    "graduation", "diploma", "achievement", "success", "accomplishment", "milestone", "future"
  ],

  // === GAMING & TECHNOLOGY ===
  gaming: [
    "gamer", "gaming", "esports", "tournament", "competitive", "pro", "streamer", "twitch",
    "console", "pc", "mobile", "arcade", "retro", "pixel", "8bit", "16bit", "nostalgic",
    "rpg", "mmo", "fps", "strategy", "puzzle", "action", "adventure", "simulation", "racing",
    "xbox", "playstation", "nintendo", "steam", "epic", "controller", "joystick", "keyboard",
    "virtual-reality", "vr", "augmented-reality", "ar", "online", "multiplayer", "solo"
  ],
  
  // === CRYPTOCURRENCY & BLOCKCHAIN ===
  crypto: [
    "crypto", "cryptocurrency", "bitcoin", "ethereum", "blockchain", "defi", "nft", "token",
    "mining", "wallet", "exchange", "trading", "hodl", "diamond-hands", "moon", "bull", "bear",
    "smart-contract", "dao", "web3", "metaverse", "digital", "decentralized", "peer-to-peer",
    "altcoin", "stablecoin", "yield-farming", "liquidity", "staking", "consensus", "node"
  ],
  
  // === CULTURAL & GEOGRAPHICAL ===
  cultural: [
    "american", "usa", "patriotic", "stars-stripes", "western", "cowboy", "ranch", "rodeo",
    "french", "parisian", "european", "continental", "chic", "elegant", "sophistication", "cafe",
    "italian", "mediterranean", "tuscan", "roman", "pizza", "pasta", "wine", "renaissance",
    "japanese", "asian", "zen", "minimalist", "cherry-blossom", "samurai", "ninja", "origami",
    "mexican", "latin", "fiesta", "colorful", "spicy", "taco", "salsa", "mariachi", "vibrant",
    "british", "english", "royal", "crown", "tea", "gentleman", "classic", "traditional", "proper",
    "scandinavian", "nordic", "minimal", "clean", "hygge", "simple", "functional", "natural",
    "tropical", "island", "paradise", "beach", "palm", "coconut", "exotic", "vacation", "resort",
    "urban", "city", "metropolitan", "downtown", "street", "graffiti", "hip-hop", "modern",
    "rural", "country", "farm", "barn", "field", "countryside", "rustic", "authentic", "homemade"
  ]
};

// === SEMANTIC DICTIONARY WITH FONT MAPPINGS ===
const SEMANTIC_DICTIONARY = {
  // === BUSINESS SECTORS ===
  'restaurant': {
    synonyms: KEYWORD_COLLECTIONS.food,
    contexts: ['vintage', 'artisan', 'warm', 'cozy', 'appetizing', 'delicious', 'gourmet', 'authentic'],
    fonts: ['Playfair Display', 'Merriweather', 'Lora', 'Crimson Text', 'Libre Baskerville', 'Source Serif Pro', 'PT Serif'],
    phrases: ['restaurant logo', 'food business', 'cafe branding', 'bistro menu', 'gourmet dining']
  },

  'automotive': {
    synonyms: KEYWORD_COLLECTIONS.automotive,
    contexts: ['masculine', 'technical', 'powerful', 'speed', 'performance', 'industrial', 'mechanical'],
    fonts: ['Oswald', 'Bebas Neue', 'Roboto Condensed', 'Barlow', 'Rajdhani', 'Exo', 'Orbitron'],
    phrases: ['garage logo', 'auto repair', 'car dealership', 'mechanic business', 'automotive brand']
  },

  'tech': {
    synonyms: KEYWORD_COLLECTIONS.technology,
    contexts: ['modern', 'clean', 'professional', 'futuristic', 'innovative', 'efficient', 'scalable'],
    fonts: ['Inter', 'Roboto', 'Lato', 'Source Sans Pro', 'Fira Sans', 'Work Sans', 'IBM Plex Sans', 'JetBrains Mono'],
    phrases: ['tech startup', 'software company', 'app development', 'digital agency', 'coding bootcamp']
  },

  'beauty': {
    synonyms: KEYWORD_COLLECTIONS.beauty,
    contexts: ['elegant', 'feminine', 'soft', 'premium', 'luxury', 'delicate', 'sophisticated'],
    fonts: ['Playfair Display', 'Cormorant Garamond', 'Dancing Script', 'Great Vibes', 'Poppins', 'Montserrat', 'Lato'],
    phrases: ['beauty salon', 'spa branding', 'cosmetics brand', 'makeup artist', 'skincare line']
  },

  'fitness': {
    synonyms: KEYWORD_COLLECTIONS.fitness,
    contexts: ['dynamic', 'energy', 'movement', 'powerful', 'competitive', 'strong', 'fast'],
    fonts: ['Oswald', 'Barlow', 'Roboto', 'Montserrat', 'Source Sans Pro', 'Nunito', 'Exo'],
    phrases: ['gym logo', 'fitness center', 'personal trainer', 'workout app', 'sports brand']
  },

  'luxury': {
    synonyms: KEYWORD_COLLECTIONS.luxury,
    contexts: ['elegant', 'sophisticated', 'premium', 'exclusive', 'refined', 'prestigious'],
    fonts: ['Playfair Display', 'Cormorant Garamond', 'EB Garamond', 'Crimson Text', 'Libre Baskerville'],
    phrases: ['luxury brand', 'high-end boutique', 'premium service', 'exclusive club', 'upscale business']
  },

  'creative': {
    synonyms: KEYWORD_COLLECTIONS.creative,
    contexts: ['artistic', 'innovative', 'expressive', 'unique', 'inspiring', 'original'],
    fonts: ['Montserrat', 'Poppins', 'Raleway', 'Nunito', 'Work Sans', 'Source Sans Pro'],
    phrases: ['design studio', 'creative agency', 'art gallery', 'photography business', 'marketing firm']
  },

  'medical': {
    synonyms: KEYWORD_COLLECTIONS.healthcare,
    contexts: ['professional', 'serious', 'trust', 'clean', 'sterile', 'reliable', 'scientific'],
    fonts: ['Source Sans Pro', 'Lato', 'Roboto', 'Open Sans', 'Inter', 'Work Sans'],
    phrases: ['medical practice', 'dental clinic', 'veterinary hospital', 'health center', 'pharmacy brand']
  },

  'legal': {
    synonyms: KEYWORD_COLLECTIONS.professional.filter(word => 
      ['law', 'legal', 'attorney', 'lawyer', 'court', 'judge'].includes(word)
    ),
    contexts: ['serious', 'professional', 'trust', 'stable', 'conservative', 'reliable', 'established'],
    fonts: ['Source Serif Pro', 'Crimson Text', 'Libre Baskerville', 'Lora', 'PT Serif'],
    phrases: ['law firm', 'legal services', 'attorney office', 'court representation', 'legal advice']
  },

  // === VISUAL STYLES ===
  'vintage': {
    synonyms: ['vintage', 'retro', 'old', 'classic', 'antique', 'nostalgic', 'aged', 'historic', 'timeless', 'heritage'],
    contexts: ['decoration', 'restaurant', 'bar', 'boutique', 'artisan', 'craft', 'handmade', 'authentic'],
    fonts: ['serif', 'slab', 'decorative', 'vintage', 'distressed', 'typewriter'],
    phrases: ['vintage style', 'retro branding', 'classic design', 'antique shop', 'heritage brand']
  },

  'modern': {
    synonyms: ['modern', 'contemporary', 'clean', 'minimal', 'simple', 'fresh', 'current', 'trendy', 'sleek'],
    contexts: ['tech', 'startup', 'design', 'architecture', 'digital', 'web', 'app', 'software'],
    fonts: ['Inter', 'Roboto', 'Poppins', 'Montserrat', 'Work Sans', 'Source Sans Pro', 'Nunito', 'Sora'],
    phrases: ['modern design', 'contemporary style', 'clean branding', 'minimal logo', 'sleek interface']
  },

  'elegant': {
    synonyms: ['elegant', 'sophisticated', 'refined', 'classy', 'graceful', 'chic', 'luxury', 'premium'],
    contexts: ['fashion', 'beauty', 'wedding', 'hotel', 'jewelry', 'perfume', 'spa', 'luxury'],
    fonts: ['Playfair Display', 'Cormorant Garamond', 'EB Garamond', 'Crimson Text', 'Libre Baskerville'],
    phrases: ['elegant design', 'sophisticated branding', 'luxury style', 'refined aesthetic', 'classy logo']
  },

  'playful': {
    synonyms: ['playful', 'fun', 'cheerful', 'happy', 'joyful', 'colorful', 'amusing', 'dynamic', 'energetic'],
    contexts: ['kids', 'children', 'game', 'animation', 'event', 'party', 'celebration', 'entertainment'],
    fonts: ['display', 'rounded', 'decorative', 'comic', 'playful', 'cartoon'],
    phrases: ['playful design', 'fun branding', 'kids logo', 'cheerful style', 'colorful brand']
  }
};

// === PHRASE PROCESSING SYSTEM ===
class PhraseProcessor {
  constructor() {
    this.businessPhrases = [
      // Professional contexts
      'i am a', 'i\'m a', 'we are a', 'we\'re a', 'my business is',
      'i own a', 'i run a', 'i work at a', 'i need a font for my',
      'looking for a font for', 'need branding for', 'logo design for',
      
      // Business descriptions
      'garage mechanic', 'auto repair shop', 'car dealership', 'automotive business',
      'restaurant owner', 'cafe owner', 'food business', 'bakery owner',
      'beauty salon', 'hair stylist', 'makeup artist', 'spa owner',
      'fitness trainer', 'gym owner', 'personal coach', 'sports business',
      'tech startup', 'software company', 'app developer', 'web agency',
      'law firm', 'legal practice', 'attorney office', 'lawyer',
      'medical practice', 'dental clinic', 'veterinary clinic', 'pharmacy',
      'real estate', 'property management', 'construction company', 'contractor'
    ];
    
    this.intentPhrases = [
      'want a font for my logo', 'need a typeface for', 'looking for fonts for',
      'branding for my business', 'logo design', 'website fonts', 'brand identity',
      'professional look', 'modern style', 'vintage feel', 'elegant design',
      'bold and strong', 'clean and minimal', 'fun and playful', 'luxury brand'
    ];
  }

  // Extract business context from natural language
  extractBusinessContext(text) {
    const lowercaseText = text.toLowerCase();
    const contexts = [];
    
    // Check for business type mentions
    Object.entries(KEYWORD_COLLECTIONS).forEach(([category, keywords]) => {
      keywords.forEach(keyword => {
        if (lowercaseText.includes(keyword)) {
          contexts.push({
            category,
            keyword,
            confidence: this.calculateKeywordConfidence(keyword, lowercaseText)
          });
        }
      });
    });
    
    // Sort by confidence and return top matches
    return contexts
      .sort((a, b) => b.confidence - a.confidence)
      .slice(0, 5);
  }

  // Calculate how well a keyword matches in context
  calculateKeywordConfidence(keyword, text) {
    let confidence = 0;
    
    // Exact word match
    const wordBoundaryRegex = new RegExp(`\\b${keyword}\\b`, 'i');
    if (wordBoundaryRegex.test(text)) {
      confidence += 10;
    }
    
    // Partial match
    if (text.includes(keyword)) {
      confidence += 5;
    }
    
    // Context clues
    this.businessPhrases.forEach(phrase => {
      if (text.includes(phrase)) {
        confidence += 3;
      }
    });
    
    // Keyword length bonus (longer = more specific)
    confidence += Math.min(keyword.length / 3, 5);
    
    return confidence;
  }

  // Parse complex search queries
  parseSearchQuery(query) {
    const contexts = this.extractBusinessContext(query);
    const styles = this.extractStylePreferences(query);
    const emotions = this.extractEmotionalContext(query);
    
    return {
      businessContexts: contexts,
      stylePreferences: styles,
      emotionalContext: emotions,
      confidence: this.calculateOverallConfidence(contexts, styles, emotions)
    };
  }

  // Extract style preferences from text
  extractStylePreferences(text) {
    const styles = [];
    const lowercaseText = text.toLowerCase();
    
    KEYWORD_COLLECTIONS.styles.forEach(style => {
      if (lowercaseText.includes(style)) {
        styles.push(style);
      }
    });
    
    return styles;
  }

  // Extract emotional context
  extractEmotionalContext(text) {
    const emotions = [];
    const lowercaseText = text.toLowerCase();
    
    KEYWORD_COLLECTIONS.emotions.forEach(emotion => {
      if (lowercaseText.includes(emotion)) {
        emotions.push(emotion);
      }
    });
    
    return emotions;
  }

  // Calculate overall query confidence
  calculateOverallConfidence(contexts, styles, emotions) {
    const totalFactors = contexts.length + styles.length + emotions.length;
    if (totalFactors === 0) return 0;
    
    const avgConfidence = contexts.reduce((sum, ctx) => sum + ctx.confidence, 0) / Math.max(contexts.length, 1);
    const styleBonus = styles.length * 2;
    const emotionBonus = emotions.length * 1.5;
    
    return Math.min(100, avgConfidence + styleBonus + emotionBonus);
  }
}

// === INTELLIGENT SEARCH FUNCTIONS ===

// Main search function that handles both keywords and phrases
function intelligentFontSearch(query) {
  const processor = new PhraseProcessor();
  const parsedQuery = processor.parseSearchQuery(query);
  
  const results = [];
  const usedConcepts = new Set();
  
  // Process business contexts
  parsedQuery.businessContexts.forEach(context => {
    const concept = findSemanticConcept(context.category, context.keyword);
    if (concept && !usedConcepts.has(concept.key)) {
      results.push({
        concept: concept.key,
        data: concept.data,
        score: context.confidence + 10,
        reason: `Business context: ${context.keyword}`
      });
      usedConcepts.add(concept.key);
    }
  });
  
  // Process style preferences
  parsedQuery.stylePreferences.forEach(style => {
    const concept = findSemanticConcept('styles', style);
    if (concept && !usedConcepts.has(concept.key)) {
      results.push({
        concept: concept.key,
        data: concept.data,
        score: 8,
        reason: `Style preference: ${style}`
      });
      usedConcepts.add(concept.key);
    }
  });
  
  // Fallback to traditional keyword search
  if (results.length === 0) {
    const traditionalResults = traditionalSearch(query);
    results.push(...traditionalResults);
  }
  
  return {
    results: results.sort((a, b) => b.score - a.score),
    confidence: parsedQuery.confidence,
    interpretation: generateSearchInterpretation(parsedQuery)
  };
}

// Find semantic concept by category and keyword
function findSemanticConcept(category, keyword) {
  for (const [conceptKey, conceptData] of Object.entries(SEMANTIC_DICTIONARY)) {
    if (conceptData.synonyms && conceptData.synonyms.includes(keyword)) {
      return { key: conceptKey, data: conceptData };
    }
  }
  return null;
}

// Traditional keyword-based search
function traditionalSearch(query) {
  const results = [];
  const queryWords = query.toLowerCase().split(/\s+/);
  
  Object.entries(SEMANTIC_DICTIONARY).forEach(([conceptKey, conceptData]) => {
    let score = 0;
    let matchedWords = [];
    
    queryWords.forEach(word => {
      if (conceptData.synonyms.includes(word)) {
        score += 10;
        matchedWords.push(word);
      }
      
      if (conceptData.contexts && conceptData.contexts.some(ctx => ctx.includes(word))) {
        score += 5;
        matchedWords.push(word);
      }
    });
    
    if (score > 0) {
      results.push({
        concept: conceptKey,
        data: conceptData,
        score,
        reason: `Keywords: ${matchedWords.join(', ')}`
      });
    }
  });
  
  return results;
}

// Generate human-readable search interpretation
function generateSearchInterpretation(parsedQuery) {
  const parts = [];
  
  if (parsedQuery.businessContexts.length > 0) {
    const topContext = parsedQuery.businessContexts[0];
    parts.push(`Detected business: ${topContext.category} (${topContext.keyword})`);
  }
  
  if (parsedQuery.stylePreferences.length > 0) {
    parts.push(`Style preferences: ${parsedQuery.stylePreferences.join(', ')}`);
  }
  
  if (parsedQuery.emotionalContext.length > 0) {
    parts.push(`Mood: ${parsedQuery.emotionalContext.join(', ')}`);
  }
  
  return parts.join(' | ') || 'General search';
}

// === EXAMPLE USAGE ===
/*
// Example searches that should work:
intelligentFontSearch("I'm a garage mechanic and I want a font for my logo")
intelligentFontSearch("need a modern font for my tech startup")  
intelligentFontSearch("elegant font for beauty salon")
intelligentFontSearch("vintage restaurant branding")
intelligentFontSearch("bold automotive business")
*/

// Export everything
if (typeof module !== 'undefined' && module.exports) {
  module.exports = {
    SEMANTIC_DICTIONARY,
    KEYWORD_COLLECTIONS,
    PhraseProcessor,
    intelligentFontSearch,
    traditionalSearch
  };
} else {
  // Browser environment
  window.SEMANTIC_DICTIONARY = SEMANTIC_DICTIONARY;
  window.KEYWORD_COLLECTIONS = KEYWORD_COLLECTIONS;
  window.PhraseProcessor = PhraseProcessor;
  window.intelligentFontSearch = intelligentFontSearch;
  window.traditionalSearch = traditionalSearch;
}